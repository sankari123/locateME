<!DOCTYPE html>
<html>
    <head>
	<script type="text/javascript" src="cordova.js"></script>
        <script src="http://maps.google.com/maps/api/js?sensor=false"> </script>
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBTGsC54Q-CH9L0c3R6MRhjatNKS3VHrfQ" type="text/javascript"></script>
        <script>
		var canvas,ctx;
    var mouseX,mouseY,mouseDown=0;
    var touchX,touchY;
    var lastX,lastY=-1;
	var tmp;
    var pictureSource;   // picture source
    var destinationType; // sets the format of returned value
   var drawn=null;
    document.addEventListener("deviceready",onDeviceReady,false);
    var latitude ;
		var longitude;
            if (navigator.geolocation)
            {
                navigator.geolocation.getCurrentPosition(handle_geolocation_query);
            }
            else
            {
               alert("Geolocation API not supported.");
            }
		
    function onDeviceReady() {
    	 document.addEventListener("backbutton", function (e) {
        e.preventDefault(); 
    navigator.notification.confirm("Do you want to exit DIVE?", onConfirmExit, "DIVE", "Yes,No");
    }, false );
}
		//
		
		function showMenu()
 {
    
	
//window.location.href = "http://www.writeacademy.in/dive/tstphp.php?lat1=" + latitude+"&long1="+longitude; 
     }
	 var return_data;
	 var return_data1;
	 
	function ajaxFunction(){
         var hr=new XMLHttpRequest();
		 var url="passVar1.php";
		 var queryString = "lat1=" + latitude +"&long11=" + longitude;
		// alert(queryString);
         hr.open("POST",url,true);
		hr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
		hr.onreadystatechange=function(){
		if(hr.readyState==4 && hr.status==200)
		{
		return_data=hr.responseText;
		return_data1=return_data;
	document.getElementById("ajaxDiv").innerHTML=return_data1;
	document.getElementById('rest1').value=return_data;
	procVal();
			}
		
		}
   hr.send(queryString);
 document.getElementById("ajaxDiv").innerHTML="Procesing......";
 //document.getElementById("rest1").value="processing";
  
  

}
var locArr;
var tmpDat1;
var latR;
var c,ctx;
var result;
function procVal()
{
//document.getElementById('rest1').value=document.getElementById("ajaxDiv").innerHTML;
if(document.getElementById("rest1").value.length==0)
{
flg='n';
alert("1");
}
else
{
locArr = document.getElementById("rest1").value;
locArr = locArr.substring(0, locArr.length - 1);
locArr=locArr.split('#');
//var a = ["a", "b", "c"];
tmpDat1='';
locArr.forEach(function(item){
   delimiter = ',';
   start = 1;
   result = item.split(delimiter, start+1).join(delimiter);
   //alert(result);
  // latR=result.substring(result.indexOf(',')+1);
   latR=result.split(',');
  // alert(latR);
   tmpDat1 +="&markers=color:blue|label:U|" +latR[0]+","+latR[1];
  // alert(tmpDat1);
   //option.value = result;
   //list.appendChild(option);
});
document.getElementById("tmpD").value=tmpDat1;
flg='y';
}
if(flg=='y')
{//alert(trim(tmpDat1));
//navigator.geolocation.getCurrentPosition(handle_geolocation_query);
newMap(tmpDat1);
}
}



function newMap(newVal)
{

c = document.getElementById("myCanvas");
			 ctx = c.getContext("2d");
			 c.width = window.innerWidth;
			c.height = window.innerHeight;
			ctx.clearRect(0,0,c.width, c.height);
		 var google_tile =  "http://maps.google.com/maps/api/staticmap?sensor=false&center=" + latitude + "," +longitude + "&zoom=13&size="+c.width+"x"+c.height+newVal;

		 var imageObj = new Image();
            imageObj.src = google_tile;
            
            imageObj.onload = function(){
              ctx.drawImage(imageObj, 0, 0);
            }
}
		
			
			function handle_geolocation_query(position)
        {
		 latitude = position.coords.latitude;
                longitude = position.coords.longitude;
                document.getElementById("lat1").value=latitude;
			   document.getElementById("long1").value= longitude;
				
		 // alert(longitude);
		     c = document.getElementById("myCanvas");
			 ctx = c.getContext("2d");
			 c.width = window.innerWidth;
			c.height = window.innerHeight;
			ctx.clearRect(0,0,c.width, c.height);
   		  
			
           var google_tile = "http://maps.google.com/maps/api/staticmap?sensor=false&center=" + latitude + "," +longitude + "&zoom=16&size="+c.width+"x"+c.height+"&markers=color:blue|label:U|" +latitude + ',' + longitude;
		  			//var google_tile = "http://maps.google.com/maps/api/staticmap?sensor=false&center=" + latitude + "," +longitude + "&zoom=19&size=300x400&markers=color:blue|label:U|" +latitude + ',' + longitude;
           
            var imageObj = new Image();
            imageObj.src = google_tile;
            
            imageObj.onload = function(){
              ctx.drawImage(imageObj, 0, 0);
            }
	  //  showUser();
        }
		
        </script>
     <title>DIVE</title>
    </head>
    <style>
    #myCanvas {
        height: 400px;
        width: 700px;
     }
	#mapPlaceholder {
        height: 400px;
        width: 700px;
		}
		 .hideDontTakeUpSpace
        {
            display:none;
        }
		
    </style>
    <body onload="procVal();">
	    <table>
<form id="add_contact" action="passVar1.php" method="post">
<input type="text" class="hideDontTakeUpSpace" id="lat1" /> <br />
<input type="text" class="hideDontTakeUpSpace" id="long1" /> 
<div id='ajaxDiv' class="hideDontTakeUpSpace">Your result will display here

</div>
<textarea id="rest1" class="hideDontTakeUpSpace" rows=10 cols=50></textarea>
<textarea id="tmpD" rows=10 cols=50></textarea>
<tr><td><input type="button" value="LIST" onclick="ajaxFunction();" /></td><td><input type="button" value="MAP" id="mapItm" onclick="showMenu();" /></td></tr>
</form>
	    </table>
        <div>
			<div id="mapPlaceholder">  <canvas id="myCanvas">   </canvas></div>
        </div>
    </body>
</html>
