<!DOCTYPE html>
<html>
    <head>
	<script type="text/javascript" src="cordova.js"></script>
        <script src="http://maps.google.com/maps/api/js?sensor=false"> </script>
		
        <script>
		var canvas,c, ctx;
		var flg;
	    var return_data;
		
		var latitude ;
		var longitude;
		var locArr;
		var tmpDat1;
		var latR;
		var result;
		var zoom1;
		zoom1=19;
		document.addEventListener("deviceready",onDeviceReady,false);
		if (navigator.geolocation)
          {
            navigator.geolocation.getCurrentPosition(handle_geolocation_query);
          }
        else
          {
             alert("Geolocation API not supported.");
          }
		
                function zoomP()
		{
		  zoom1++;
		  navigator.geolocation.getCurrentPosition(handle_geolocation_query);
		
		}
		function zoomM()
		{
		  zoom1--;
		  navigator.geolocation.getCurrentPosition(handle_geolocation_query);
		
		}
		function onDeviceReady()
               {
		
    	      document.addEventListener("backbutton", function (e) {
             e.preventDefault(); 
             navigator.notification.confirm("Do you want to exit DIVE?", onConfirmExit, "DIVE", "Yes,No");    }, false );
              }
	
	function onConfirmExit(button) {
    if(button==2){ //If User select a No, then return back;
        return;
    }else{
    	if (navigator.app) {
            navigator.app.exitApp();
        }
        else if (navigator.device) {
            navigator.device.exitApp();
        }
       // navigator.app.exitApp(); // If user select a Yes, quit from the app.
    }
}
		
	 
	function ajaxFunction(){
         var hr=new XMLHttpRequest();
		 var url="passVar1.php";
		 var queryString = "lat1=" + latitude +"&long11=" + longitude;
		
         hr.open("POST",url,true);
		hr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
		hr.onreadystatechange=function(){
		if(hr.readyState==4 && hr.status==200)
		{
			return_data=hr.responseText;
			document.getElementById("ajaxDiv").innerHTML=return_data;
			document.getElementById('rest1').value=return_data;
			procVal();
		}
		
		}
		hr.send(queryString);
 }


function procVal(){
	if(document.getElementById("rest1").value.length==0)
	{
		//flg='n';
		//alert("Detecting YOur Location");
	}
	else
	{
		flg='y';
		//alert("Searching DIVE Joints");
		locArr = document.getElementById("rest1").value;
		locArr = locArr.substring(0, locArr.length - 1);
		locArr=locArr.split('#');
		tmpDat1='';

		for (var i = 0, len = locArr.length; i < len; i++) {
		delimiter = ',';
		start = 1;
		result = locArr[i].split(delimiter, start+1).join(delimiter);
		latR=result.split(',');
		tmpDat1 +="&markers=" +latR[0]+","+latR[1];
		}
		document.getElementById("tmpD").value=tmpDat1;
		navigator.geolocation.getCurrentPosition(handle_geolocation_query);
		
	}	
	
	
}



	function handle_geolocation_query(position)
    {
		lat1 = position.coords.latitude;
        long1 = position.coords.longitude;
        c = document.getElementById("myCanvas");
		ctx = c.getContext("2d");
		//c.width = window.innerWidth;
//c.height = window.innerHeight;
		ctx.clearRect(0,0,c.width, c.height);
   		if(flg=='y')
			{
			zoom1=14;
				document.getElementById("btn").style.position = 'fixed';
var google_tile = "http://maps.googleapis.com/maps/api/staticmap?center=" + lat1 + "," +long1 + "&zoom="+zoom1+"&size="+c.width+"x"+c.height+tmpDat1+"&sensor=false";
			}
		else
			{
           var google_tile = "http://maps.google.com/maps/api/staticmap?sensor=false&center=" + lat1 + "," +long1 + "&zoom="+zoom1+"&size="+c.width+"x"+c.height+"&markers=color:blue|label:U|" +lat1 + ',' + long1;
			}
		var imageObj = new Image();
        imageObj.src = google_tile;
        imageObj.onload = function(){
           ctx.drawImage(imageObj, 0, 0);
        }
			
	 }
		
        </script>
     <title>DIVE</title>
    </head>
    <style>
    body, html {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden;
}
	

    #myCanvas {
        height: 100%;
        width: 100%;
		position: fixed;
     }
	#mapPlaceholder {
        height: 400px;
        width: 700px;
		position: absolute;
		}
		 .hideDontTakeUpSpace
        {
            display:none;
		position:fixed;
        }
		#controls
{
  top: 0;
  left: 0;
  position: absolute;
  
}
	    #btn
	    {
	    position:absolute;
	    }
	    #mnu1
	    {
	    position:fixed;
	    }
	    
		
    </style>
    <body onload="procVal();">
	    <div>
	    <table width="100%">
<form id="add_contact" action="passVar1.php" method="post">

<textarea id="tmpD"  class="hideDontTakeUpSpace" rows=1 cols=50></textarea>
<textarea id="rest1"  class="hideDontTakeUpSpace" rows=1 cols=50></textarea>
<tr><td width="50%" ><input type="button" id="mnu" value="LIST" onclick="ajaxFunction();" /></td><td><input type="button" width="50%" id="mnu" value="MAP" id="mapItm" onclick="showMenu();" /></td></tr>
</form>
	    </table>
	    </div>
        <div>
			<div id="mapPlaceholder">  
				<canvas id="myCanvas">   </canvas>
					<menu >
						<input type="button" id="btn" style="z-index:2;  top:0; left:0" value="+"/ onclick="zoomP();"><input type="button" value="-" id="btn" style="z-index:2; top:0; left:2" onclick="zoomM();"/>
					</menu>	
					</div>
        </div>
	    <div id='ajaxDiv' class="hideDontTakeUpSpace">Your result will display here</div>
    </body>
</html>
